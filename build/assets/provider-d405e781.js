var f=Object.defineProperty;var v=(e,t,r)=>t in e?f(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var d=(e,t,r)=>(v(e,typeof t!="symbol"?t+"":t,r),r);import{k as p,l as a,D as h,m as L,n as S,o as g,q as w,s as y,v as m}from"./index-d8397883.js";import{P as E,a as H}from"./provider-8ecf57ec.js";import{VideoProvider as D}from"./provider-f9f6459b.js";class j{constructor(t,r,i){this.Ia=t,this.Ha=r,this.X=i,this.Ja()}async Ja(){const t={onLoadStart:this.v.bind(this),onLoaded:this.F.bind(this),onLoadError:this.Ka.bind(this)};let r=await F(this.Ia,t);if(p(r)&&!a(this.Ia)&&(r=await I(this.Ia,t)),!r)return null;if(!r.isSupported()){const i="[vidstack]: `hls.js` is not supported in this environment";return this.Ha.player.dispatchEvent(new h("hls-unsupported")),this.Ha.delegate.L("error",{detail:{message:i,code:4}}),null}return r}v(){this.Ha.player.dispatchEvent(new h("hls-lib-load-start"))}F(t){this.Ha.player.dispatchEvent(new h("hls-lib-loaded",{detail:t})),this.X(t)}Ka(t){const r=L(t);this.Ha.player.dispatchEvent(new h("hls-lib-load-error",{detail:r})),this.Ha.delegate.L("error",{detail:{message:r.message,code:4}})}}async function I(e,t={}){var r,i,n,o,u;if(!p(e)){if((r=t.onLoadStart)==null||r.call(t),e.prototype&&e.prototype!==Function)return(i=t.onLoaded)==null||i.call(t,e),e;try{const s=(n=await e())==null?void 0:n.default;if(s&&s.isSupported)(o=t.onLoaded)==null||o.call(t,s);else throw Error("");return s}catch(s){(u=t.onLoadError)==null||u.call(t,s)}}}async function F(e,t={}){var r,i,n;if(a(e)){(r=t.onLoadStart)==null||r.call(t);try{if(await S(e),!g(window.Hls))throw Error("");const o=window.Hls;return(i=t.onLoaded)==null||i.call(t,o),o}catch(o){(n=t.onLoadError)==null||n.call(t,o)}}}const P="https://cdn.jsdelivr.net";var J;class C extends D{constructor(){super(...arguments);d(this,J,"HLS");d(this,"Ea",null);d(this,"l",new H(this.video));d(this,"Da",`${P}/npm/hls.js@^1.0.0/dist/hls.min.js`)}get ctor(){return this.Ea}get instance(){return this.l.instance}get type(){return"hls"}get canLiveSync(){return!0}get config(){return this.l.Fa}set config(r){this.l.Fa=r}get library(){return this.Da}set library(r){this.Da=r}preconnect(){a(this.Da)&&y(this.Da)}setup(r){super.setup(r),new j(this.Da,r,i=>{this.Ea=i,this.l.setup(i,r),r.delegate.j("provider-setup",{detail:this});const n=m(r.$store.source);n&&this.loadSource(n)})}async loadSource({src:r}){var i;a(r)&&((i=this.l.instance)==null||i.loadSource(r))}onInstance(r){const i=this.l.instance;return i&&r(i),this.l.Ga.add(r),()=>this.l.Ga.delete(r)}destroy(){this.l.ga()}}J=E,d(C,"supported",w());export{C as HLSProvider};
